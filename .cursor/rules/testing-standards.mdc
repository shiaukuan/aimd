---
alwaysApply: true
description: æ¸¬è©¦ç­–ç•¥å’ŒåŸ·è¡Œæµç¨‹è¦ç¯„
---

# æ¸¬è©¦è¦ç¯„

## æ¸¬è©¦ç­–ç•¥

### ğŸ¯ ç„¡ä¾‹å¤–æ¸¬è©¦æ”¿ç­–

**ä»»ä½•æƒ…æ³ä¸‹éƒ½ä¸æ‡‰è©²å°‡ä»»ä½•æ¸¬è©¦é¡å‹æ¨™è¨˜ç‚ºã€Œä¸é©ç”¨ã€**

- æ¯å€‹å°ˆæ¡ˆéƒ½å¿…é ˆæœ‰ï¼šunit testsã€integration testsã€end-to-end tests
- å¦‚æœèªç‚ºæŸç¨®æ¸¬è©¦é¡å‹ä¸é©ç”¨ï¼Œéœ€è¦æ˜ç¢ºæˆæ¬Šï¼šã€Œæˆ‘æˆæ¬Šä½ é€™æ¬¡è·³éå¯«æ¸¬è©¦ã€

### ğŸ“Š æ¸¬è©¦æ¶æ§‹

æ¡ç”¨ **Colocation æ¸¬è©¦æ¶æ§‹**ï¼Œæ¸¬è©¦æª”æ¡ˆèˆ‡åŸå§‹æª”ä¸¦åˆ—ï¼š

```
src/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ ui/
â”‚   â”‚   â”œâ”€â”€ button.tsx
â”‚   â”‚   â””â”€â”€ button.test.tsx     # å–®å…ƒæ¸¬è©¦
â”‚   â””â”€â”€ editor/
â”‚       â”œâ”€â”€ EditorPanel.tsx
â”‚       â””â”€â”€ EditorPanel.test.tsx
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useMarpRenderer.ts
â”‚   â””â”€â”€ useMarpRenderer.test.ts
â””â”€â”€ lib/
    â”œâ”€â”€ utils.ts
    â””â”€â”€ utils.test.ts

tests/
â””â”€â”€ e2e/
    â”œâ”€â”€ basic.spec.ts           # E2E æ¸¬è©¦
    â””â”€â”€ slide-editor.spec.ts
```

## æ¸¬è©¦å·¥å…·é…ç½®

### ğŸ§ª å–®å…ƒèˆ‡æ•´åˆæ¸¬è©¦ (Vitest)

```bash
# ä¸»è¦æ¸¬è©¦æŒ‡ä»¤
pnpm test                    # åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦
pnpm test:watch             # ç›£è¦–æ¨¡å¼
pnpm test:coverage          # è¦†è“‹ç‡å ±å‘Š
pnpm test <æª”æ¡ˆå>          # åŸ·è¡Œç‰¹å®šæ¸¬è©¦æª”æ¡ˆ
```

**é‡è¦æª”æ¡ˆ**ï¼š

- é…ç½®æª”æ¡ˆ: [vitest.config.ts](mdc:vitest.config.ts)
- æ¸¬è©¦è¨­å®š: [src/test/setup.ts](mdc:src/test/setup.ts)

### ğŸ­ E2E æ¸¬è©¦ (Playwright)

```bash
# E2E æ¸¬è©¦æŒ‡ä»¤
pnpm test:e2e               # åŸ·è¡Œ E2E æ¸¬è©¦
pnpm test:e2e:chrome        # Chrome ç€è¦½å™¨
pnpm test:e2e:ui            # UI æ¨¡å¼
pnpm test:e2e:headed        # é¡¯ç¤ºç€è¦½å™¨
```

**é‡è¦æª”æ¡ˆ**ï¼š

- é…ç½®æª”æ¡ˆ: [playwright.config.ts](mdc:playwright.config.ts)
- æ¸¬è©¦ç›®éŒ„: `tests/e2e/`

## æ¸¬è©¦åŸ·è¡Œæµç¨‹

### ğŸ”„ å¼·åˆ¶åŸ·è¡Œé †åº

**æ¯æ’°å¯«ï¼ä¿®æ”¹ä»»ä½•ç¨‹å¼ç¢¼å¾Œå‹™å¿…ä¾åºåŸ·è¡Œ**ï¼š

```bash
# 1. åŸ·è¡Œå–®å…ƒ/æ•´åˆæ¸¬è©¦
pnpm test

# 2. åŸ·è¡Œç«¯å°ç«¯æ¸¬è©¦
pnpm test:e2e
```

**è‹¥æœ‰æ¸¬è©¦å¤±æ•—**ï¼š

1. å…ˆä¿®æ­£ç¨‹å¼æˆ–æ¸¬è©¦
2. å†é‡è·‘å…©æ¢æŒ‡ä»¤
3. ç›´åˆ°**å…¨ç¶ **æ‰èƒ½ç¹¼çºŒ

### ğŸ“ˆ è¦†è“‹ç‡è¦æ±‚

- **é–¾å€¼æ¨™æº–**: 70% (statements, branches, functions, lines)
- **ç›£æ§å·¥å…·**: @vitest/coverage-v8
- **æª¢æŸ¥æŒ‡ä»¤**: `pnpm test:coverage`

## TDD å¯¦è¸æµç¨‹

### ğŸ”´ Red Phase (å¤±æ•—æ¸¬è©¦)

```typescript
// 1. å…ˆå¯«ä¸€å€‹å¤±æ•—çš„æ¸¬è©¦
describe('SlideEditor', () => {
  it('should generate slides from markdown', () => {
    // æœŸæœ›çš„è¡Œç‚ºä½†å°šæœªå¯¦ä½œ
    expect(generateSlides('# Hello')).toHaveLength(1);
  });
});
```

### ğŸŸ¢ Green Phase (æœ€å°å¯¦ä½œ)

```typescript
// 2. å¯«æœ€å°‘çš„ç¨‹å¼ç¢¼è®“æ¸¬è©¦é€šé
function generateSlides(markdown: string) {
  return [{ content: markdown }]; // æœ€å°å¯¦ä½œ
}
```

### ğŸ”§ Refactor Phase (é‡æ§‹)

```typescript
// 3. åœ¨æ¸¬è©¦ä¿è­·ä¸‹é‡æ§‹å’Œå„ªåŒ–
function generateSlides(markdown: string): Slide[] {
  // æ”¹é€²å¯¦ä½œä½†ä¿æŒæ¸¬è©¦é€šé
  return parseMarkdownToSlides(markdown);
}
```

## æ¸¬è©¦æ’°å¯«è¦ç¯„

### ğŸ“ æ¸¬è©¦æª”æ¡ˆçµæ§‹

```typescript
// ABOUTME: æ­¤æª”æ¡ˆæ¸¬è©¦ Button å…ƒä»¶çš„å„ç¨®è®Šé«”å’Œäº’å‹•è¡Œç‚º
// ABOUTME: åŒ…å«å¯å­˜å–æ€§ã€é»æ“Šäº‹ä»¶å’Œæ¨£å¼è®Šé«”çš„æ¸¬è©¦æ¡ˆä¾‹

import { render, screen, fireEvent } from '@testing-library/react';
import { Button } from './button';

describe('Button', () => {
  describe('æ¸²æŸ“è¡Œç‚º', () => {
    it('should render with default props', () => {
      // æ¸¬è©¦å¯¦ä½œ
    });
  });

  describe('äº’å‹•è¡Œç‚º', () => {
    it('should handle click events', () => {
      // æ¸¬è©¦å¯¦ä½œ
    });
  });

  describe('å¯å­˜å–æ€§', () => {
    it('should have proper ARIA attributes', () => {
      // æ¸¬è©¦å¯¦ä½œ
    });
  });
});
```

### ğŸ¯ æ¸¬è©¦æ’°å¯«åŸå‰‡

1. **æ¸…æ™°æè¿°**: æ¸¬è©¦åç¨±æ¸…æ¥šæè¿°æœŸæœ›è¡Œç‚º
2. **å–®ä¸€è·è²¬**: æ¯å€‹æ¸¬è©¦åªé©—è­‰ä¸€å€‹è¡Œç‚º
3. **å®Œæ•´è¦†è“‹**: åŒ…å«æ­£å¸¸ã€é‚Šç•Œå’ŒéŒ¯èª¤æƒ…æ³
4. **ç¶­è­·æ€§**: æ¸¬è©¦æ˜“æ–¼ç†è§£å’Œä¿®æ”¹

### ğŸš¨ æ¸¬è©¦è¦æ±‚

- **å¿…é ˆæ¶µè“‹**ï¼šæ­£åœ¨å¯¦ä½œçš„æ‰€æœ‰åŠŸèƒ½
- **çµ•ä¸å¿½ç•¥**ï¼šç³»çµ±æˆ–æ¸¬è©¦çš„è¼¸å‡º
- **å®Œç¾è¼¸å‡º**ï¼šæ¸¬è©¦è¼¸å‡ºå¿…é ˆå®Œç¾ç„¡ç¼ºæ‰é€šé
- **éŒ¯èª¤æ•ç²**ï¼šå¦‚æœæ‡‰è©²æœ‰éŒ¯èª¤ï¼Œæ•ç²ä¸¦æ¸¬è©¦å®ƒ

## æ¸¬è©¦æ¡ˆä¾‹é¡å‹

### ğŸ§ª å–®å…ƒæ¸¬è©¦

```typescript
// Hook æ¸¬è©¦
describe('useMarpRenderer', () => {
  it('should render markdown to HTML', async () => {
    const { result } = renderHook(() => useMarpRenderer());
    await act(async () => {
      await result.current.render('# Test');
    });
    expect(result.current.result?.html).toContain('<h1>Test</h1>');
  });
});

// å·¥å…·å‡½æ•¸æ¸¬è©¦
describe('utils', () => {
  it('should merge CSS classes correctly', () => {
    expect(cn('btn', 'btn-primary')).toBe('btn btn-primary');
  });
});
```

### ğŸ”— æ•´åˆæ¸¬è©¦

```typescript
// å…ƒä»¶æ•´åˆæ¸¬è©¦
describe('EditorPanel Integration', () => {
  it('should sync content with preview', async () => {
    render(<EditorPanelWithPreview />);
    const editor = screen.getByRole('textbox');

    fireEvent.change(editor, { target: { value: '# New Slide' } });

    await waitFor(() => {
      expect(screen.getByText('New Slide')).toBeInTheDocument();
    });
  });
});
```

### ğŸ­ E2E æ¸¬è©¦

```typescript
// å®Œæ•´ä½¿ç”¨è€…æµç¨‹æ¸¬è©¦
test('should create and preview slides', async ({ page }) => {
  await page.goto('/');

  // è¼¸å…¥ Markdown
  await page.fill('[data-testid="markdown-editor"]', '# Hello World');

  // æª¢æŸ¥é è¦½
  await expect(page.locator('[data-testid="slide-preview"]')).toContainText(
    'Hello World'
  );

  // æ¸¬è©¦å°èˆª
  await page.click('[data-testid="next-slide"]');
});
```

## æ•ˆèƒ½æ¸¬è©¦

### âš¡ æ¸²æŸ“æ•ˆèƒ½

```typescript
describe('Performance', () => {
  it('should render large markdown files efficiently', async () => {
    const largeMarkdown = '# Slide\n\n'.repeat(100);
    const start = performance.now();

    await renderMarkdown(largeMarkdown);

    const duration = performance.now() - start;
    expect(duration).toBeLessThan(1000); // 1ç§’å…§å®Œæˆ
  });
});
```

## å¯å­˜å–æ€§æ¸¬è©¦

### â™¿ A11y æ¸¬è©¦

```typescript
import { axe, toHaveNoViolations } from 'jest-axe';

expect.extend(toHaveNoViolations);

describe('Accessibility', () => {
  it('should have no accessibility violations', async () => {
    const { container } = render(<SlideEditor />);
    const results = await axe(container);
    expect(results).toHaveNoViolations();
  });
});
```

åƒè€ƒæª”æ¡ˆï¼š

- [æ¸¬è©¦è¨­å®šæ•™å­¸](mdc:docs/testing-setup-tutorial.md)
- [Vitest é…ç½®](mdc:vitest.config.ts)
- [Playwright é…ç½®](mdc:playwright.config.ts)
