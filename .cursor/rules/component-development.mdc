---
alwaysApply: true
description: React å…ƒä»¶å’Œ TypeScript é–‹ç™¼è¦ç¯„
---

# å…ƒä»¶é–‹ç™¼è¦ç¯„

## React å…ƒä»¶è¦ç¯„

### ğŸ§© å…ƒä»¶çµæ§‹æ¨¡å¼

æ‰€æœ‰ React å…ƒä»¶éƒ½æ‡‰éµå¾ªçµ±ä¸€çš„çµæ§‹æ¨¡å¼ï¼š

```typescript
// ABOUTME: æ­¤å…ƒä»¶è² è²¬æŠ•å½±ç‰‡ç·¨è¼¯å™¨çš„ä¸»è¦å®¹å™¨åŠŸèƒ½
// ABOUTME: æ•´åˆå·¥å…·åˆ—ã€ç·¨è¼¯å€åŸŸå’Œç‹€æ…‹åˆ—ï¼Œç®¡ç†çµ±è¨ˆè¨ˆç®—å’Œæ ¼å¼åŒ–æ“ä½œ

import React from 'react';
import { type ComponentProps } from '@/types';

interface EditorPanelProps {
  // å®Œæ•´çš„ props å‹åˆ¥å®šç¾©
  content: string;
  onChange: (content: string) => void;
  className?: string;
}

export function EditorPanel({
  content,
  onChange,
  className
}: EditorPanelProps) {
  // Hook èª¿ç”¨
  const [isModified, setIsModified] = useState(false);

  // äº‹ä»¶è™•ç†å™¨
  const handleContentChange = useCallback((newContent: string) => {
    onChange(newContent);
    setIsModified(true);
  }, [onChange]);

  // æ¸²æŸ“
  return (
    <div className={cn('editor-panel', className)}>
      {/* JSX å…§å®¹ */}
    </div>
  );
}

// é è¨­åŒ¯å‡ºï¼ˆå¦‚æœæ˜¯ä¸»è¦å…ƒä»¶ï¼‰
export default EditorPanel;
```

### ğŸ“¦ å…ƒä»¶åŒ¯å‡ºè¦ç¯„

```typescript
// åœ¨ index.ts ä¸­çµ±ä¸€åŒ¯å‡º
export { EditorPanel } from './EditorPanel';
export { MarkdownEditor } from './MarkdownEditor';
export { EditorToolbar } from './EditorToolbar';
export { EditorStatusBar } from './EditorStatusBar';

// å‹åˆ¥ä¹Ÿè¦åŒ¯å‡º
export type { EditorPanelProps } from './EditorPanel';
```

## TypeScript å‹åˆ¥è¦ç¯„

### ğŸ¯ å‹åˆ¥å®šç¾©åŸå‰‡

- **å‹åˆ¥å„ªå…ˆ**: é¿å…ä½¿ç”¨ `any`ï¼Œå„ªå…ˆå®šç¾©æ˜ç¢ºå‹åˆ¥
- **çµ±ä¸€å®šç¾©**: æ‰€æœ‰å‹åˆ¥å®šç¾©æ”¾åœ¨ `src/types/` ç›®éŒ„
- **ä»‹é¢å‘½å**: ä½¿ç”¨ PascalCaseï¼Œå…ƒä»¶ Props ä»¥ `Props` çµå°¾

### ğŸ“‹ å‹åˆ¥å®šç¾©çµæ§‹

```typescript
// src/types/editor.ts
export interface EditorStats {
  characters: number;
  charactersNoSpaces: number;
  words: number;
  lines: number;
  selectedText: string;
  selectedLength: number;
  cursorLine: number;
  cursorColumn: number;
}

export interface EditorSettings {
  tabSize: number;
  insertSpaces: boolean;
  wordWrap: boolean;
  lineNumbers: boolean;
  fontSize: number;
  theme: 'light' | 'dark' | 'auto';
}

export type EditorAction =
  | 'new'
  | 'open'
  | 'save'
  | 'export'
  | 'bold'
  | 'italic'
  | 'heading1'
  | 'heading2'
  | 'heading3';
```

### ğŸ”§ Props å‹åˆ¥è¨­è¨ˆ

```typescript
// åŸºç¤ Props ä»‹é¢
interface BaseComponentProps {
  className?: string;
  children?: React.ReactNode;
}

// å…·é«”å…ƒä»¶ Props
interface ButtonProps extends BaseComponentProps {
  variant?:
    | 'default'
    | 'destructive'
    | 'outline'
    | 'secondary'
    | 'ghost'
    | 'link';
  size?: 'default' | 'sm' | 'lg' | 'icon';
  disabled?: boolean;
  onClick?: () => void;
}

// ä½¿ç”¨æ³›å‹çš„é€²éš Props
interface FormFieldProps<T> extends BaseComponentProps {
  value: T;
  onChange: (value: T) => void;
  validation?: (value: T) => string | null;
}
```

## Hook é–‹ç™¼è¦ç¯„

### ğŸª è‡ªå®šç¾© Hook çµæ§‹

```typescript
// ABOUTME: æ­¤ Hook ç®¡ç† Marp å¼•æ“çš„æ¸²æŸ“é‚è¼¯å’Œç‹€æ…‹
// ABOUTME: æä¾› debounced æ¸²æŸ“ã€éŒ¯èª¤è™•ç†å’Œé‡è©¦æ©Ÿåˆ¶

import { useState, useCallback, useRef } from 'react';
import { useDebounce } from './useDebounce';

interface UseMarpRendererOptions {
  debounceMs?: number;
  onError?: (error: MarpError) => void;
}

interface UseMarpRendererReturn {
  result: MarpRenderResult | null;
  status: MarpRenderStatus;
  render: (markdown: string) => Promise<void>;
  clear: () => void;
  retry: () => Promise<void>;
}

export function useMarpRenderer(
  options: UseMarpRendererOptions = {}
): UseMarpRendererReturn {
  // ç‹€æ…‹ç®¡ç†
  const [result, setResult] = useState<MarpRenderResult | null>(null);
  const [status, setStatus] = useState<MarpRenderStatus>('idle');

  // å¯¦ä½œé‚è¼¯
  const render = useCallback(async (markdown: string) => {
    // æ¸²æŸ“é‚è¼¯
  }, []);

  return {
    result,
    status,
    render,
    clear,
    retry,
  };
}
```

### ğŸ”„ Hook ä½¿ç”¨æ¨¡å¼

```typescript
// åœ¨å…ƒä»¶ä¸­ä½¿ç”¨ Hook
export function SlidePreview() {
  const { content } = useEditorStore();
  const {
    result,
    status,
    render
  } = useMarpRenderer({
    debounceMs: 300,
    onError: (error) => console.error('Render error:', error),
  });

  // éŸ¿æ‡‰å…§å®¹è®ŠåŒ–
  useEffect(() => {
    if (content) {
      render(content);
    }
  }, [content, render]);

  // è™•ç†ä¸åŒç‹€æ…‹
  if (status === 'error') {
    return <ErrorDisplay />;
  }

  return <SlideRenderer result={result} />;
}
```

## ç‹€æ…‹ç®¡ç†è¦ç¯„

### ğŸª Zustand Store çµæ§‹

```typescript
// ABOUTME: æ­¤ Store ç®¡ç†ç·¨è¼¯å™¨çš„å…¨åŸŸç‹€æ…‹
// ABOUTME: åŒ…å«å…§å®¹ã€åŒæ­¥ã€å„²å­˜å’ŒéŒ¯èª¤ç‹€æ…‹çš„çµ±ä¸€ç®¡ç†

import { create } from 'zustand';
import { subscribeWithSelector } from 'zustand/middleware';

interface EditorState {
  // ç‹€æ…‹å®šç¾©
  content: string;
  isModified: boolean;
  error: string | null;

  // å‹•ä½œå®šç¾©
  setContent: (content: string) => void;
  updateContent: (content: string) => void;
  setError: (error: string | null) => void;
  clearError: () => void;
}

export const useEditorStore = create<EditorState>()(
  subscribeWithSelector((set, get) => ({
    // åˆå§‹ç‹€æ…‹
    content: '',
    isModified: false,
    error: null,

    // å‹•ä½œå¯¦ä½œ
    setContent: content => set({ content, isModified: false }),
    updateContent: content => set({ content, isModified: true }),
    setError: error => set({ error }),
    clearError: () => set({ error: null }),
  }))
);
```

## æ•ˆèƒ½æœ€ä½³åŒ–è¦ç¯„

### âš¡ React æ•ˆèƒ½æœ€ä½³åŒ–

```typescript
// ä½¿ç”¨ React.memo é¿å…ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“
export const SlideViewer = React.memo<SlideViewerProps>(({
  slide,
  isActive
}) => {
  return (
    <div className={cn('slide-viewer', { active: isActive })}>
      {slide.content}
    </div>
  );
});

// ä½¿ç”¨ useMemo å¿«å–æ˜‚è²´è¨ˆç®—
export function EditorStatusBar({ content }: EditorStatusBarProps) {
  const stats = useMemo(() =>
    calculateEditorStats(content),
    [content]
  );

  return <div>{stats.words} words</div>;
}

// ä½¿ç”¨ useCallback ç©©å®šå‡½æ•¸å¼•ç”¨
export function EditorPanel({ onChange }: EditorPanelProps) {
  const handleChange = useCallback((newContent: string) => {
    onChange(newContent);
  }, [onChange]);

  return <MarkdownEditor onChange={handleChange} />;
}
```

### ğŸ”„ é˜²æŠ–å‹•å’Œç¯€æµ

```typescript
// ä½¿ç”¨ useDebounce é¿å…éåº¦é »ç¹æ›´æ–°
export function useAutoSave(content: string) {
  const debouncedContent = useDebounce(content, 500);

  useEffect(() => {
    if (debouncedContent) {
      saveToLocalStorage(debouncedContent);
    }
  }, [debouncedContent]);
}
```

## éŒ¯èª¤è™•ç†è¦ç¯„

### ğŸš¨ éŒ¯èª¤é‚Šç•Œ

```typescript
// ABOUTME: æ­¤å…ƒä»¶æä¾› React éŒ¯èª¤é‚Šç•ŒåŠŸèƒ½
// ABOUTME: æ•ç²å­å…ƒä»¶éŒ¯èª¤ä¸¦æä¾›æ¢å¾©æ©Ÿåˆ¶

interface ErrorBoundaryState {
  hasError: boolean;
  error: Error | null;
}

export class ErrorBoundary extends React.Component<
  React.PropsWithChildren<{}>,
  ErrorBoundaryState
> {
  constructor(props: React.PropsWithChildren<{}>) {
    super(props);
    this.state = { hasError: false, error: null };
  }

  static getDerivedStateFromError(error: Error): ErrorBoundaryState {
    return { hasError: true, error };
  }

  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {
    console.error('éŒ¯èª¤é‚Šç•Œæ•ç²éŒ¯èª¤:', error, errorInfo);
  }

  render() {
    if (this.state.hasError) {
      return <ErrorFallback error={this.state.error} />;
    }

    return this.props.children;
  }
}
```

### ğŸ”§ éŒ¯èª¤è™•ç†æ¨¡å¼

```typescript
// çµ±ä¸€çš„éŒ¯èª¤è™•ç†
export function handleAsyncError<T>(
  promise: Promise<T>,
  onError?: (error: Error) => void
): Promise<T | null> {
  return promise.catch((error) => {
    console.error('éåŒæ­¥æ“ä½œå¤±æ•—:', error);
    if (onError) {
      onError(error);
    }
    return null;
  });
}

// åœ¨å…ƒä»¶ä¸­ä½¿ç”¨
export function SlideEditor() {
  const [error, setError] = useState<string | null>(null);

  const handleSave = async () => {
    const result = await handleAsyncError(
      saveSlides(content),
      (error) => setError(error.message)
    );

    if (result) {
      setError(null);
    }
  };

  return (
    <div>
      {error && <ErrorAlert message={error} />}
      <button onClick={handleSave}>å„²å­˜</button>
    </div>
  );
}
```

## å¯å­˜å–æ€§è¦ç¯„

### â™¿ A11y æœ€ä½³å¯¦å‹™

```typescript
// æä¾›é©ç•¶çš„ ARIA å±¬æ€§
export function SlideControlBar({
  currentSlide,
  totalSlides,
  onPrevious,
  onNext
}: SlideControlBarProps) {
  return (
    <div
      role="toolbar"
      aria-label="æŠ•å½±ç‰‡å°èˆªæ§åˆ¶"
    >
      <button
        onClick={onPrevious}
        disabled={currentSlide === 0}
        aria-label="ä¸Šä¸€å¼µæŠ•å½±ç‰‡"
      >
        <ChevronLeft />
      </button>

      <span
        aria-live="polite"
        aria-label={`ç¬¬ ${currentSlide + 1} å¼µï¼Œå…± ${totalSlides} å¼µæŠ•å½±ç‰‡`}
      >
        {currentSlide + 1} / {totalSlides}
      </span>

      <button
        onClick={onNext}
        disabled={currentSlide === totalSlides - 1}
        aria-label="ä¸‹ä¸€å¼µæŠ•å½±ç‰‡"
      >
        <ChevronRight />
      </button>
    </div>
  );
}
```

åƒè€ƒæª”æ¡ˆï¼š

- [å‹åˆ¥å®šç¾©](mdc:src/types/index.ts)
- [ç·¨è¼¯å™¨ç‹€æ…‹ç®¡ç†](mdc:src/store/editorStore.ts)
- [UI å…ƒä»¶ç¯„ä¾‹](mdc:src/components/ui/button.tsx)
- [Hook ç¯„ä¾‹](mdc:src/hooks/useMarpRenderer.ts)
