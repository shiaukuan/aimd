# 核心原則

- **系統性思維**：看到具體問題時，思考對整個系統的影響，而不僅是解決表面問題。
- **長遠考慮**：評估技術債務和維護成本，優先選擇簡單、乾淨、可維護的解決方案。
- **品質優先**：可讀性和可維護性是首要考量，勝過短期的聰明或複雜的方案。

# 開發工作流程

我們採用 **文件與測試驅動開發 (Documentation & Test-Driven Development)** 的流程。

1.  **理解與分析 (Understand & Analyze)**
    - ❌ **絕對禁止**：急於動手、跳過分析步驟。
    - **查閱文件**：首先查閱 `docs/` 目錄下的既有文件，了解目前的設計與架構。
    - **分析需求**：徹底分析問題的根本原因。
2.  **文件與測試 (Document & Test - Red Phase 🔴)**
    - **更新文件**：如有架構變更或新增功能，先在 `docs/` 中草擬文件或更新現有文件。
    - **撰寫失敗測試**：為新功能撰寫一個明確描述期望行為的失敗測試。
    - **執行單一測試**：為求快速反饋，執行 `pnpm test <相關測試檔案>` 來確認該測試如預期般失敗。
3.  **撰寫程式碼 (Code - Green Phase 🟢)**
    - **最小實作**：只寫足夠的程式碼讓測試通過。
    - **遵循規範**：遵守下述的「程式碼撰寫規範」。
    - **快速驗證**：再次執行 `pnpm test <相關測試檔案>` 確認測試轉為綠色。
4.  **重構與交付 (Refactor & Deliver 🔧)**
    - **持續重構**：在單一測試保護下，持續改進程式碼的可讀性與設計，並隨時執行 `pnpm test <相關測試檔案>` 保持測試通過。
    - **完善文件**：最終完善 `docs/` 中的文件，確保與實作一致，包含使用範例和設計理念。
    - **✅ 最終完整驗證 (Final Verification)**：在完成所有變更後，**務必執行完整的測試套件** `pnpm test` 及 `pnpm test:e2e`，確保沒有任何回歸問題 (regression) 並保證所有測試完美通過。

# 程式碼撰寫規範

- **最小變更**：只做與當前任務直接相關的最小合理變更。
- **風格一致**：優先保持檔案內的程式碼風格一致性。
- **註解原則**：
  - 所有檔案都需以 `// ABOUTME:` 開頭的兩行註解說明其作用。
  - 註解應描述「為何」而非「如何」，且內容應是永恆的，避免提及時間背景。
  - 絕不輕易移除既有註解。
- **命名原則**：命名應描述功能本身，避免使用 `new`, `improved` 等時間性詞彙。
- **重寫限制**：未經明確許可，絕不丟棄舊實作進行重寫。

# 溝通規範

- **語言**：所有溝通、註解、文件一律使用**繁體中文**。
- **澄清**：主動提問以澄清需求，絕不自行假設。
